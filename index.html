<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=32&h=32&fit=crop&crop=center" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Discover and book amazing kids activities, events, and educational programs in the UAE. Find the perfect activities for your children with Gema Events." />
    <meta name="keywords" content="kids activities, children events, educational programs, family fun, kids entertainment, booking platform, UAE, Dubai" />
    <meta name="author" content="Gema Events" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="en-US" />
    <meta name="revisit-after" content="7 days" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Gema Events - Kids Activities Platform" />
    <meta property="og:description" content="Discover and book amazing kids activities, events, and educational programs in the UAE." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://gema-events.com" />
    <meta property="og:image" content="/assets/images/og-default.jpg" />
    <meta property="og:site_name" content="Gema Events" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Gema Events - Kids Activities Platform" />
    <meta name="twitter:description" content="Discover and book amazing kids activities, events, and educational programs in the UAE." />
    <meta name="twitter:image" content="/assets/images/og-default.jpg" />
    <meta name="twitter:site" content="@gemaevents" />
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3B82F6" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Gema Events" />
    <meta name="application-name" content="Gema Events" />
    <meta name="msapplication-TileColor" content="#3B82F6" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/apple-touch-icon.svg" />
    <link rel="mask-icon" href="/icon-192x192.svg" color="#3B82F6" />
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Cairo:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    
    <!-- Leaflet CSS for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <title>Gema Events - Discover Amazing Kids Activities & Events in UAE</title>

    <!-- Organization Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Gema Events",
      "description": "Discover and book amazing kids activities, events, and educational programs in the UAE",
      "url": "https://gema-events.com",
      "logo": "https://gema-events.com/assets/images/logo.png",
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "email": "info@gema-events.com"
      },
      "sameAs": [
        "https://www.facebook.com/gemaevents",
        "https://www.instagram.com/gemaevents",
        "https://www.twitter.com/gemaevents"
      ],
      "areaServed": {
        "@type": "Country",
        "name": "United Arab Emirates"
      },
      "serviceType": [
        "Event Management",
        "Kids Activities",
        "Educational Programs",
        "Family Entertainment"
      ]
    }
    </script>

    <!-- CRITICAL: Pre-chunk polyfill fixes - Must run before ANY JavaScript chunks load -->
    <script>
      (function() {
        // UNIVERSAL CHUNK PROTECTION: Comprehensive fetch API polyfill protection
        console.log('[Pre-Chunk Fix] Setting up universal fetch API protection');

        // Get the primary global object using the same resolution as axios
        var safeGlobal =
          (typeof globalThis !== "undefined" && globalThis) ||
          (typeof window !== "undefined" && window) ||
          (typeof self !== "undefined" && self) ||
          (typeof global !== "undefined" && global) ||
          {};

        // Get polyfilled APIs safely (avoiding ReferenceErrors)
        function getPolyfillAPIs() {
          try {
            return {
              fetch: typeof fetch !== 'undefined' ? fetch : undefined,
              Request: typeof Request !== 'undefined' ? Request : undefined,
              Response: typeof Response !== 'undefined' ? Response : undefined,
              Headers: typeof Headers !== 'undefined' ? Headers : undefined,
            };
          } catch (e) {
            console.warn('[Pre-Chunk Fix] Error accessing APIs:', e);
            return { fetch: undefined, Request: undefined, Response: undefined, Headers: undefined };
          }
        }

        var apis = getPolyfillAPIs();

        // Enhanced API setting with multiple fallback strategies
        function setAPIOnGlobal(globalObj, apiName, apiValue) {
          if (!globalObj || !apiValue) return false;

          try {
            // Strategy 1: Delete and redefine as enumerable (most reliable)
            delete globalObj[apiName];
            Object.defineProperty(globalObj, apiName, {
              value: apiValue,
              writable: true,
              enumerable: true,  // CRITICAL for destructuring
              configurable: true
            });
            return true;
          } catch (e1) {
            try {
              // Strategy 2: Direct assignment
              globalObj[apiName] = apiValue;
              return true;
            } catch (e2) {
              try {
                // Strategy 3: Force assignment (bypasses some restrictions)
                Object.assign(globalObj, { [apiName]: apiValue });
                return true;
              } catch (e3) {
                console.warn('[Pre-Chunk Fix] All strategies failed for', apiName, 'on', globalObj);
                return false;
              }
            }
          }
        }

        // Apply to ALL potential global objects with comprehensive coverage
        var allGlobals = [safeGlobal];

        // Add other globals if different from primary
        [globalThis, window, global, self].forEach(function(g) {
          if (g && typeof g === 'object' && g !== safeGlobal && allGlobals.indexOf(g) === -1) {
            allGlobals.push(g);
          }
        });

        var totalFixed = 0;
        var globalResults = {};

        allGlobals.forEach(function(globalObj, index) {
          var globalName = globalObj === globalThis ? 'globalThis' :
                          globalObj === window ? 'window' :
                          globalObj === self ? 'self' :
                          globalObj === global ? 'global' :
                          'global' + index;

          var results = {};
          var localFixed = 0;

          Object.keys(apis).forEach(function(apiName) {
            if (apis[apiName]) {
              var success = setAPIOnGlobal(globalObj, apiName, apis[apiName]);
              results[apiName] = success;
              if (success) {
                localFixed++;
                totalFixed++;
              }
            } else {
              results[apiName] = false;
            }
          });

          globalResults[globalName] = {
            fixed: localFixed,
            apis: results
          };
        });

        // Comprehensive verification
        var finalVerification = {
          globalUsed: safeGlobal === globalThis ? 'globalThis' :
                      safeGlobal === window ? 'window' :
                      safeGlobal === self ? 'self' :
                      safeGlobal === global ? 'global' : 'fallback',
          totalAPIsFixed: totalFixed,
          perGlobal: globalResults,
          primaryGlobal: {
            fetch: !!safeGlobal.fetch,
            Request: !!safeGlobal.Request,
            Response: !!safeGlobal.Response,
            Headers: !!safeGlobal.Headers,
            requestEnumerable: safeGlobal.propertyIsEnumerable ? safeGlobal.propertyIsEnumerable('Request') : 'unknown',
            responseEnumerable: safeGlobal.propertyIsEnumerable ? safeGlobal.propertyIsEnumerable('Response') : 'unknown'
          }
        };

        console.log('[Pre-Chunk Fix] ✅ Universal chunk protection applied:', finalVerification);

        // Multiple destructuring tests with different strategies
        var destructureResults = [];

        // Test 1: Direct destructuring from primary global
        try {
          var testResult1 = (function(testGlobal) {
            var destructured = (function({Request: R, Response: Res, Headers: H}) {
              return {
                Request: !!R,
                Response: !!Res,
                Headers: !!H,
                allPresent: !!(R && Res && H)
              };
            })(testGlobal);
            return { success: true, result: destructured, method: 'primary-global' };
          })(safeGlobal);
          destructureResults.push(testResult1);
        } catch (e) {
          destructureResults.push({ success: false, error: e.message, method: 'primary-global' });
        }

        // Test 2: Object.keys based test (mimics some libraries)
        try {
          var keys = Object.keys(safeGlobal);
          var hasRequiredKeys = keys.indexOf('Request') !== -1 && keys.indexOf('Response') !== -1;
          destructureResults.push({
            success: hasRequiredKeys,
            result: { hasRequiredKeys: hasRequiredKeys, keys: keys.filter(function(k) { return k.match(/^(fetch|Request|Response|Headers)$/); }) },
            method: 'object-keys'
          });
        } catch (e) {
          destructureResults.push({ success: false, error: e.message, method: 'object-keys' });
        }

        // Log results
        var allTestsPassed = destructureResults.filter(function(r) { return r.success; }).length > 0;
        if (allTestsPassed) {
          console.log('[Pre-Chunk Fix] ✅ Destructuring tests PASSED - axios should work');
        } else {
          console.error('[Pre-Chunk Fix] ❌ All destructuring tests FAILED');
          console.error('[Pre-Chunk Fix] Test results:', destructureResults);
        }

        // Enhanced polyfill status tracking
        window.__POLYFILL_STATUS__ = {
          source: 'enhanced-pre-chunk-fix',
          timestamp: Date.now(),
          verification: finalVerification,
          destructureTests: destructureResults,
          success: allTestsPassed,
          apis: {
            fetch: finalVerification.primaryGlobal.fetch,
            Request: finalVerification.primaryGlobal.Request,
            Response: finalVerification.primaryGlobal.Response,
            Headers: finalVerification.primaryGlobal.Headers
          }
        };

        // Emergency axios protection: Override axios utils.getGlobal if needed
        try {
          // This is a last-resort patch that ensures axios gets a valid global
          var originalGetGlobal = window.getGlobal;
          window.getGlobal = function() {
            var result = safeGlobal;
            console.log('[Pre-Chunk Fix] getGlobal() called, returning:', result);
            return result;
          };

          // Also patch any existing axios reference
          if (window.axios && window.axios.defaults) {
            console.log('[Pre-Chunk Fix] Found existing axios, applying emergency patches');
          }
        } catch (e) {
          console.log('[Pre-Chunk Fix] Emergency axios patches not needed:', e.message);
        }

        console.log('[Pre-Chunk Fix] Setup complete. APIs should be available for all chunks.');
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>